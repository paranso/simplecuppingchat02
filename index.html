<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Brewing Form</title>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: sans-serif; line-height: 1.6; padding: 20px; max-width: 700px; margin: auto; background-color: #f9f9f9; }
    .container { background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { text-align: center; color: #333; margin-bottom: 30px; }
    h2 { color: #555; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-top: 30px; margin-bottom: 15px; font-size: 1.2em; }
    .section { margin-bottom: 30px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; color: #666; }
    input[type="text"], input[type="date"], input[type="number"], textarea {
      width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 0.95em;
    }
    textarea { min-height: 80px; resize: vertical; }
    .date-row { display: flex; gap: 15px; }
    .date-row label { flex: 1; }
    .options { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; font-size: 0.9em; }
    .options label {
      font-weight: normal; display: flex; align-items: center; gap: 4px; cursor: pointer;
      padding: 5px 10px; border: 1px solid #eee; border-radius: 15px; background-color: #fdfdfd;
    }
    .rating-group { margin-top: 15px; }
    .rating-container { display: flex; align-items: center; gap: 10px; }
    .rating-label { font-size: 0.8em; color: #888; }
    .rating-slider-container { flex-grow: 1; display: flex; align-items: center; gap: 8px; }
    input[type="range"] { flex-grow: 1; cursor: pointer; }
    .rating-value {
      font-weight: bold; font-size: 0.9em; min-width: 15px; text-align: center;
      background-color: #eee; padding: 2px 6px; border-radius: 3px;
    }
    .input-group { position: relative; margin-bottom: 15px; }
    .input-suffix {
      position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
      color: #666; font-size: 0.9em;
    }
    .ratio-display {
      margin-left: 10px; padding: 2px 8px; background-color: #f0f8ff;
      border-radius: 4px; font-size: 0.85em; border: 1px solid #cce0ff;
      display: inline-block; visibility: hidden;
    }
    .amount-row { display: flex; gap: 15px; margin-bottom: 15px; }
    .amount-row .input-group { flex: 1; margin-bottom: 0; }
    button {
      display: block; width: 100%; padding: 12px 20px; background-color: #007bff;
      color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em;
      transition: background-color 0.2s;
    }
    button:hover { background-color: #0056b3; }
    #result-display {
      background-color: #f0f0f0; padding: 15px; border-radius: 4px;
      white-space: pre-wrap; word-wrap: break-word; font-size: 0.9em;
      border: 1px solid #e0e0e0; margin-top: 25px; font-family: 'Nanum Gothic', sans-serif;
      line-height: 1.6; color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Brewing Form</h1>

    <!-- 기본 정보 -->
    <div class="section" id="basic-info">
      <h2>기본 정보 입력</h2>
      <div class="date-row">
        <label>로스팅 날짜
          <input type="date" id="roasting-date">
        </label>
        <label>추출 날짜
          <input type="date" id="cupping-date">
        </label>
      </div>
      <label>이름 or ID
        <input type="text" id="user-id" placeholder="이름 또는 ID를 입력하세요">
      </label>
      <label>커피 정보
        <input type="text" id="coffee-name" placeholder="예) 에티오피아 예가체프">
      </label>
      <label>물 종류
        <input type="text" id="water-type" placeholder="예) 카본필터수 / 생수">
      </label>
      <label>물/온도
        <input type="text" id="drop-temp" placeholder="예) 93도">
      </label>
      <label>드리퍼/시간
        <input type="text" id="agtron" placeholder="예) 하리오v60 / 2분 30초">
      </label>
      <label>분쇄도
        <input type="text" id="grind-size" placeholder="예) 중간분쇄 / #25 / 220μm">
      </label>
      <div class="amount-row">
        <div class="input-group">
          <label for="bean-amount">원두량
            <input type="number" id="bean-amount" placeholder="예) 20" min="0" step="0.1">
            <span class="input-suffix">g</span>
          </label>
        </div>
        <div class="input-group">
          <label for="brew-amount">추출량
            <input type="number" id="brew-amount" placeholder="예) 300" min="0" step="0.1">
            <span class="input-suffix">g</span>
          </label>
        </div>
        <div id="ratio-display" class="ratio-display">비율: 1:0</div>
      </div>
    </div>

    <!-- 1. 향 맡기 -->
    <div class="section" id="aroma-section">
      <h2>1. 향 맡기</h2>
      <p>분쇄된 원두의 향을 맡고 느껴지는 향을 선택하거나 적어보세요.</p>
      <div class="options">
        <label><input type="checkbox" value="꽃향">꽃향</label>
        <label><input type="checkbox" value="과일향">과일향</label>
        <label><input type="checkbox" value="허브향">허브향</label>
        <label><input type="checkbox" value="견과류향">견과류향</label>
        <label><input type="checkbox" value="카라멜향">카라멜향</label>
        <label><input type="checkbox" value="초콜릿향">초콜릿향</label>
        <label><input type="checkbox" value="기타향">기타향</label>
      </div>
      <label>기타 향
        <input type="text" id="aroma-text" placeholder="기타 향 입력">
      </label>
      <div class="rating-group">
        <label for="aroma-rating">향 만족도</label>
        <div class="rating-container">
          <span class="rating-label">낮음</span>
          <div class="rating-slider-container">
            <input type="range" id="aroma-rating" min="1" max="5" step="1" value="3">
            <span class="rating-value">3</span>
          </div>
          <span class="rating-label">높음</span>
        </div>
      </div>
    </div>

    <!-- 2. 맛보기 -->
    <div class="section" id="taste-section">
      <h2>2. 맛보기</h2>
      <p>커피를 맛보고 느껴지는 맛을 선택하거나 적어보세요.</p>
      <div class="options">
        <label><input type="checkbox" value="단맛">단맛</label>
        <label><input type="checkbox" value="신맛">신맛</label>
        <label><input type="checkbox" value="쓴맛">쓴맛</label>
        <label><input type="checkbox" value="기타맛">기타맛</label>
      </div>
      <label>기타 맛
        <input type="text" id="taste-text" placeholder="기타 맛 입력">
      </label>
      <div class="rating-group">
        <label for="taste-rating">맛 만족도</label>
        <div class="rating-container">
          <span class="rating-label">낮음</span>
          <div class="rating-slider-container">
            <input type="range" id="taste-rating" min="1" max="5" step="1" value="3">
            <span class="rating-value">3</span>
          </div>
          <span class="rating-label">높음</span>
        </div>
      </div>
    </div>

    <!-- 3. 전체적인 느낌 -->
    <div class="section" id="feel-section">
      <h2>3. 전체적인 느낌</h2>
      <p>커피의 전체적인 느낌을 선택하거나 적어보세요.</p>
      <div class="options">
        <label><input type="checkbox" value="부드러움">부드러움</label>
        <label><input type="checkbox" value="묵직함">묵직함</label>
        <label><input type="checkbox" value="깔끔함">깔끔함</label>
        <label><input type="checkbox" value="씁쓸함">씁쓸함</label>
        <label><input type="checkbox" value="달콤함">달콤함</label>
        <label><input type="checkbox" value="상큼함">상큼함</label>
        <label><input type="checkbox" value="기타느낌">기타느낌</label>
      </div>
      <label>기타 느낌
        <input type="text" id="feel-text" placeholder="기타 느낌 입력">
      </label>
      <div class="rating-group">
        <label for="overall-rating">느낌 만족도</label>
        <div class="rating-container">
          <span class="rating-label">낮음</span>
          <div class="rating-slider-container">
            <input type="range" id="overall-rating" min="1" max="5" step="1" value="3">
            <span class="rating-value">3</span>
          </div>
          <span class="rating-label">높음</span>
        </div>
      </div>
    </div>

    <!-- 4. 추가 메모 -->
    <div class="section" id="additional-info">
      <h2>4. 추가 메모</h2>
      <label for="additional-note">추가 메모
        <textarea id="additional-note" placeholder="추가 메모 입력"></textarea>
      </label>
    </div>

    <!-- 5. 변경할 부분 상상 -->
    <div class="section" id="roasting-recommendation-section">
      <h2>5. 변경할 부분을 상상해 보세요</h2>
      <label for="roasting-recommendation">다음 브루잉을 위한 의견
        <textarea id="roasting-recommendation" placeholder="다음 브루잉을 위한 의견 입력"></textarea>
      </label>
    </div>

    <button id="save-button">결과 저장</button>
    <pre id="result-display"></pre>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const saveButton       = document.getElementById('save-button');
    const resultDisplay    = document.getElementById('result-display');

    // 기본 정보
    const roastingDateInput  = document.getElementById('roasting-date');
    const cuppingDateInput   = document.getElementById('cupping-date');
    const userIdInput        = document.getElementById('user-id');
    const coffeeNameInput    = document.getElementById('coffee-name');
    const waterTypeInput     = document.getElementById('water-type');
    const dropTempInput      = document.getElementById('drop-temp');
    const agtronInput        = document.getElementById('agtron');
    const grindSizeInput     = document.getElementById('grind-size');
    const beanAmountInput    = document.getElementById('bean-amount');
    const brewAmountInput    = document.getElementById('brew-amount');
    const ratioDisplay       = document.getElementById('ratio-display');

    // 항목 1~3
    const aromaCheckboxes    = document.querySelectorAll('#aroma-section input[type="checkbox"]');
    const aromaText          = document.getElementById('aroma-text');
    const aromaRatingInput   = document.getElementById('aroma-rating');
    const tasteCheckboxes    = document.querySelectorAll('#taste-section input[type="checkbox"]');
    const tasteText          = document.getElementById('taste-text');
    const tasteRatingInput   = document.getElementById('taste-rating');
    const feelCheckboxes     = document.querySelectorAll('#feel-section input[type="checkbox"]');
    const feelText           = document.getElementById('feel-text');
    const overallRatingInput = document.getElementById('overall-rating');

    // 추가 메모 & 추천
    const additionalNoteInput         = document.getElementById('additional-note');
    const roastingRecommendationInput = document.getElementById('roasting-recommendation');

    // 비율 계산
    function calculateRatio() {
      const bean = parseFloat(beanAmountInput.value);
      const brew = parseFloat(brewAmountInput.value);
      if (!isNaN(bean) && !isNaN(brew) && bean > 0) {
        const r = (brew / bean).toFixed(1);
        ratioDisplay.textContent = `비율: 1:${r}`;
        ratioDisplay.style.visibility = 'visible';
      } else {
        ratioDisplay.style.visibility = 'hidden';
      }
    }
    beanAmountInput.addEventListener('input', calculateRatio);
    brewAmountInput.addEventListener('input', calculateRatio);

    // 슬라이더 실시간 표시
    function setupRatingDisplay(ratingInput) {
      const display = ratingInput.closest('.rating-container').querySelector('.rating-value');
      display.textContent = ratingInput.value;
      ratingInput.addEventListener('input', () => {
        display.textContent = ratingInput.value;
      });
    }
    setupRatingDisplay(aromaRatingInput);
    setupRatingDisplay(tasteRatingInput);
    setupRatingDisplay(overallRatingInput);

    // 저장 처리
    saveButton.addEventListener('click', function() {
      // 타임스탬프
      const timestamp = new Date().toISOString();

      // 기본 정보 수집
      const roastingDate  = roastingDateInput.value;
      const cuppingDate   = cuppingDateInput.value;
      const userId        = userIdInput.value.trim();
      const coffeeName    = coffeeNameInput.value.trim();
      const waterType     = waterTypeInput.value.trim();
      const dropTemp      = dropTempInput.value.trim();
      const agtron        = agtronInput.value.trim();
      const grindSize     = grindSizeInput.value.trim();
      const beanAmount    = beanAmountInput.value.trim();
      const brewAmount    = brewAmountInput.value.trim();
      const ratioText     = ratioDisplay.textContent.replace('비율: ', '');

      // 항목 1~3
      const aromaChoices    = Array.from(aromaCheckboxes).filter(cb=>cb.checked).map(cb=>cb.value);
      const aromaCustomText = aromaText.value.trim();
      const aromaRating     = aromaRatingInput.value;

      const tasteChoices    = Array.from(tasteCheckboxes).filter(cb=>cb.checked).map(cb=>cb.value);
      const tasteCustomText = tasteText.value.trim();
      const tasteRating     = tasteRatingInput.value;

      const feelChoices     = Array.from(feelCheckboxes).filter(cb=>cb.checked).map(cb=>cb.value);
      const feelCustomText  = feelText.value.trim();
      const overallRating   = overallRatingInput.value;

      // 메모 & 추천
      const additionalNote      = additionalNoteInput.value.trim();
      const roastingRecommendation = roastingRecommendationInput.value.trim();

      // 결과 출력
      const formattedResult = `
【 브루잉 요약 】

■ 기본 정보
 - Timestamp: ${timestamp}
 - 로스팅 날짜: ${roastingDate  || '미입력'}
 - 추출 날짜: ${cuppingDate   || '미입력'}
 - 이름/ID: ${userId        || '미입력'}
 - 커피 정보: ${coffeeName    || '미입력'}
 - 물 종류: ${waterType     || '미입력'}
 - 물/온도: ${dropTemp      || '미입력'}
 - 드리퍼/시간: ${agtron      || '미입력'}
 - 분쇄도: ${grindSize     || '미입력'}
 - 원두량: ${beanAmount ? beanAmount + 'g' : '미입력'}
 - 추출량: ${brewAmount ? brewAmount + 'g' : '미입력'}${ratioText ? ` (비율: ${ratioText})` : ''}

■ 향 평가 (${aromaRating}점)
 - 선택된 향: ${aromaChoices.length ? aromaChoices.join(', ') : '없음'}
 - 기타 향: ${aromaCustomText || '없음'}

■ 맛 평가 (${tasteRating}점)
 - 선택된 맛: ${tasteChoices.length ? tasteChoices.join(', ') : '없음'}
 - 기타 맛: ${tasteCustomText || '없음'}

■ 느낌 평가 (${overallRating}점)
 - 선택된 느낌: ${feelChoices.length ? feelChoices.join(', ') : '없음'}
 - 기타 느낌: ${feelCustomText || '없음'}

■ 추가 메모
${additionalNote || '없음'}

■ 다음 브루잉 의견
${roastingRecommendation || '없음'}
      `;
      resultDisplay.textContent = formattedResult.trim();

      // 스프레드시트 저장
      const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbw2s3GL8o-Ao543QulrCPfQ67l1HkQ5DNNkQcpf8tfF-ZHhIeX-OfCQSSZHqQdAEMtv/exec';
      const payload = {
        timestamp,
        roastingDate,
        cuppingDate,
        userId,
        coffeeName,
        waterType,
        dropTemp,
        agtron,
        grindSize,
        beanAmount,
        brewAmount,
        ratio: ratioText,
        aromaChoices:      aromaChoices.join(', '),
        aromaCustomText,
        aromaRating,
        tasteChoices:      tasteChoices.join(', '),
        tasteCustomText,
        tasteRating,
        feelChoices:       feelChoices.join(', '),
        feelCustomText,
        overallRating,
        additionalNote,
        roastingRecommendation
      };

      fetch(https://script.google.com/macros/s/AKfycbw2s3GL8o-Ao543QulrCPfQ67l1HkQ5DNNkQcpf8tfF-ZHhIeX-OfCQSSZHqQdAEMtv/exec, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json; charset=utf-8' },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(res => {
        if (res.status === 'success') {
          alert('데이터 저장 성공!');
        } else {
          alert('저장 오류: ' + res.message);
        }
      })
      .catch(err => {
        alert('저장 중 오류 발생: ' + err.message);
      });
    });
  });
  </script>
</body>
</html>
